# ASP.NET
# Build and test ASP.NET projects.
# Add steps that publish symbols, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/apps/aspnet/build-aspnet-4

trigger:
- master

pool:
  vmImage: 'windows-latest'

variables:
  solution: '**/*.sln'
  buildPlatform: 'Any CPU'
  buildConfiguration: 'Release'

steps:
- powershell: |
    function Logstash_Mapping{ Param ([Parameter(Mandatory = $true)][string]$Workingfolder)
      echo "Workingfolder: $Workingfolder";
    }
    Logstash_Mapping -Workingfolder 10

    $deploymentrecordcount = 5
    Write-Output ("##vso[task.setvariable variable=deploymentrecordcount;isOutput=true]$deploymentrecordcount")
    Write-Host "Set deploymentrecordcount to $deploymentrecordcount"
  displayName: 'Set Deployment Record Count'
  name: 'count'

- powershell: |
    Write-Host "Reading environment variable deploymentrecordcount..."
    if ($env:deploymentrecordcount) {
        Write-Host "Deployment Record Count in subsequent task: $env:deploymentrecordcount"
    } else {
        Write-Host "Environment variable deploymentrecordcount is not set"
    }
    echo "before printing"
    echo "Count is: $deploymentrecordcount"
    echo "Count varuable is: $count"
    echo "env is $env"
    echo "after printing"
  displayName: 'Use Deployment Record Count'